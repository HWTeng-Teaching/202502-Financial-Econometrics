## Q.06

<img width="577" alt="C08Q06" src="https://github.com/user-attachments/assets/7485f4a2-a866-415a-8cb8-f25567a9586a" />


## Ans:

題目模型：

$$
\text{WAGE}_i = \beta_1 + \beta_2 \text{EDUC}_i + \beta_3 \text{EXPER}_i + \beta_4 \text{METRO}_i + e_i
$$


**(a)** 檢驗男性與女性的誤差變異數是否相等

**資料：**
- 男性樣本數 \( n_M = 577 \)， df_M=n_M-k=577-4=573 ， SSE\(_M = 97161.9174 \)
- 女性的標準差估計值 σ̂_F² = 12.024 → σ̂²_F = 144.5766 \)

**假設：**
-  H_0: σ̂²_M = σ̂²_F
-  H_1: σ̂²_M ≠ σ̂²_F

**計算男性誤差變異數：**

$$
\hat{\sigma}_M^2 = \frac{\text{SSE}_M}{df_M} = \frac{97161.9174}{573} \approx 169.567
$$

**F 檢定統計量：**

$$
GQ = \frac{\hat{\sigma}_M^2}{\hat{\sigma}_F^2} = \frac{169.567}{144.5766} \approx 1.173
$$

**查表：**  
-  F_{573,419,0.025} = 0.8377 
-  F_{573,419,0.975} = 1.1968 

**結論：**  
因為 F統計量 沒有在落在拒絕區內(0.8377＜1.173＜1.1968) ⇒ **無法拒絕 \( H_0 \)**  
=> 無足夠證據表明兩性之間的誤差變異數不同。

---

**(b)** 檢驗已婚與單身者的誤差變異數是否不同

**資料：**
- 單身：\( n = 400 \, df=400-5=395), SSE = 56231.0382
- 已婚：\( n = 600 \, df=600-5=595), SSE = 100703.0471

**假設：**
-  H_0: σ²_MARRIED = σ²_SINGLE
-  H_1: σ²_MARRIED > σ²_SINGLE (單尾檢驗)

**計算變異數：**

$$
σ²_SINGLE = \frac{56231.0382}{400-5} = 142.357 
$$

$$
σ²_MARRIED = \frac{100703.0471}{600-5} = 169.248
$$

**F 統計量：**

$$
F = \frac{169.248}{142.357} = 1.1889
$$

**查表：**  
- F_{0.95,595,395} 臨界值大約是 1.1647（單尾）

**結論：**  
因為 F 1.1889 > 1.1647 ⇒ **拒絕 \( H_0 \)**  
=> 已婚者的誤差變異數顯著大於單身者。

---

**(c)** \( NR² \) 檢定（異質變異數檢定）

H_0:α_2=α_3=α_4=α_5=0(homoskedasticity)

H_1:not all the α_i in Ho are zero(hetroskedasticity)

NR² = 59.03 ＞ χ²_{0.95,5-1} = 9.49


**結論：**  
59.03 > 9.49 ⇒ **拒絕同質變異數假設**  
=> 表示回歸模型存在異質變異數

這與(b)部分的結論一致，該部分表明已婚和未婚個體的誤差方差不同。

NR²檢驗進一步證實了這一點，表明模型中確實存在異方差性，且這種異方差性與解釋變數有關。

---

**(d)** White Test

- 原始變量：EDUC,EXPER,METRO,FEMALE，共4個
- 平方項:EDUC²,EXPER²,METRO²,FEMALE²，共4個
- METRO & FEMALE是二元變量(0 or 1)，METRO²=METRO，FEMALE²=FEMALE(因為0²=0，1²=1)
- 這些平方項與原始變量相同，會被排除，以避免多重共線性，所以獨立的平方項只有：EDUC²,EXPER²，共2個
- 交叉項：計算所有變量間的2x2交叉項：EDUCxEXPER , EDUCxMETRO , EDUCxFEMALE , EXPERxMETRO , EXPERxFEMALE , METROxFEMALE 共6個交叉項。
  
- 總自由度為 原始變量（4個）+獨立平方項(2個)+交叉項(6個) = 12個
- 臨界值 \( χ²_{0.95,12} = 21.026 \)
- NR² = 78.82
  
**結論：**  
78.82 > 21.026 ⇒ 落在拒絕域，**拒絕 \( H_0 \)**  
=> 模型存在異質變異數問題。

這與(b)和(c)部分的結論一致，進一步證實了模型中存在異方差性。

---

**(e)** 比較 OLS 與 Robust 標準誤差

| 變數     | OLS SE | Robust SE | 變化 |
|----------|--------|--------|-----------|
| EDUC     | 0.14   | 0.16   | 變寬      | 
| EXPER    | 0.031  | 0.029  | 變窄      |
| METRO    | 1.05   | 0.84   | 變窄      | 
| FEMALE   | 0.81   | 0.80   | 變窄      | 

  
**結論：**
- EDUC 的 robust SE > OLS SE ⇒ 信賴區間變寬
- EXPER、METRO、FEMALE 的 robust SE < OLS SE ⇒ 信賴區間變窄
- White robust SE 考慮異質變異數後，更能反映真實的估計不確定性。不同變數受異質變異程度不同，導致標準誤可能變寬或變窄。

---

**(f)** MARRIED 的 t 值約為 1，是否與 (b) 衝突？

自由度很大（N=1000 , df=1000-6=994) , α=0.05(雙尾臨界值±1.96) , |t|=1.0 ＜1.96，因此MARRIED的係數在5%顯著性水平下顯著。這表示MARRIED對工資的直接影響(在控制期他變量後)不顯著。

**說明：**
- (b) 是在檢定誤差變異是否不同 ⇒ 異質變異數
- (f) 是在檢定變數 MARRIED 是否對薪資有顯著解釋力

**結論：**
- 兩者 **不衝突**。
- 二者可共存，MARRIED 對薪資本身不顯著，但誤差分布變異顯著。
- MARRIED 雖對薪資無顯著影響，但其誤差變異可大於單身者 ⇒ 合理。


---

## Q.16

<img width="585" alt="C08Q16" src="https://github.com/user-attachments/assets/d7d353b0-0635-4a00-9cf2-e28e56323861" />


## Ans:

模型形式：

$$
\[
\text{MILES}_i = \beta_1 + \beta_2 \text{INCOME}_i + \beta_3 \text{AGE}_i + \beta_4 \text{KIDS}_i + e_i
\]
$$

**(a)**  OLS 回歸與信賴區間估計

<img width="580" alt="2" src="https://github.com/user-attachments/assets/18e45cdb-d69f-4f6d-9249-ac86ae3c12b6" />

回歸結果（關注 KIDS 變數）

- KIDS（小孩數量）係數估計值**：
  β̂₄ = -81.826 

- 標準誤（Standard Error）**：
 SE(β̂₄) = 27.130

- t critical value 1.97214

- 95% 信賴區間**為：
  \[
  [-135.3298, -28.32302]
  \]

結論解釋：

在控制收入（INCOME）與年齡（AGE）的情況下，每多一位小孩，平均每年旅行距離減少約 **81.826 英里**。此估計在 95% 信賴區間下為顯著的負向影響（因為信賴區間不包含 0）。

---

**(b)** 異質變異數圖形檢查：殘差圖

1. **殘差 vs INCOME**

<img width="574" alt="Residuals vs Income_a" src="https://github.com/user-attachments/assets/edf37c40-96e2-4bb3-afc6-e384339264df" />


2. **殘差 vs AGE**

<img width="585" alt="Residuals vs Age_a" src="https://github.com/user-attachments/assets/0ce34b44-fa92-4df3-a4d5-ca3517804cf6" />


觀察結果

- **Residuals vs INCOME**
- 殘差在高收入時呈現**較大變異與擴散範圍**，有類似「漏斗狀」的分佈，這是 **異質變異數的可能徵兆**。

- **Residuals vs AGE**
- 殘差相對均勻，但亦出現一些極端點（outliers）。

結論

圖形顯示 **殘差與 INCOME 之間存在變異擴大的現象**，這表明回歸模型中**可能存在異質變異數（heteroskedasticity）**。

在殘差與收入的圖中，殘差的變異隨者收入的增加而增大，但在殘差與年齡的圖中，同樣的效果並不明顯。在後圖情况下，殘差的量級與年齡之間沒有明顯的關係。

因此，圖表看出取決於收入，而非年齡。

---

**(c)**  Goldfeld–Quandt 檢定：異質變異數檢驗

檢定步驟：

1. 根據 `income` 對樣本排序
2. 分成前 90 筆（低收入）與後 90 筆（高收入）資料
3. 分別對兩組進行 OLS 回歸並計算殘差平方和 (SSE)
4. 建立 F 統計量：

<img width="108" alt="1" src="https://github.com/user-attachments/assets/72239bfb-b9ab-4a42-b341-34cce0bb3bdf" />


結果摘要：

| 項目 | 數值 |
|------|------|
| SSE（低收入組） | 101744.65 |
| SSE（高收入組） | 315821.55 |
| F 統計量 | **3.104** |
| 臨界值（α = 0.05，df₁ = 86, df₂ = 86） | **1.4286** |

<img width="222" alt="6" src="https://github.com/user-attachments/assets/65ea332c-3003-4181-a718-22999bb0a80e" />

檢定假設：

- **虛無假設 \( H_0 \)**：σ²₁ = σ²₂ (同方差性) 高、低收入組變異數相等
- **對立假設 \( H_1 \)**：σ²₁ ﹤ σ²₂ (異方差性) 高收入組誤差變異較大

結論：

因為 \( F = 3.104 > 1.4286 \)，所以**拒絕虛無假設**。  
這表示在 5% 顯著水準下，我們有足夠證據認為模型存在 **異質變異數（heteroskedasticity）**。

---

**(d)** 使用異質變異數穩健標準誤（White robust SE）重新估計

<img width="723" alt="3" src="https://github.com/user-attachments/assets/af6c758f-ef60-4944-afab-16af2e857e8d" />


模型結果（KIDS）

- KIDS 估計值：
   β̂₄ = -81.826 

- Robust 標準誤（HC1）：
  SE_robust = 29.154

- 95% 信賴區間：
  \[
  [-138.969, -24.684]
  \]

與 (a) 小題比較：

| 模型版本     | 估計值 | 標準誤 | 95% 信賴區間              |
|--------------|--------|--------|---------------------------|
| OLS (a)      | -81.826 | 27.130  | [-135.329, -28.323]         |
| Robust OLS (d) | -81.826 | 29.154  | [-138.969, -24.684]         |

結論：

- **估計值一致**：因為模型本身沒改變。
- **標準誤變大**：robust SE 考慮了異質變異數影響。
- **信賴區間變寬**：提高推論的保守性與真實性。

White robust 標準誤能提供在誤差變異數不相等時更可靠的推論結果。


---

**(e)**  GLS 與 Robust GLS 模型估計：考慮 Var(eᵢ) = σ²·INCOMEᵢ²

假設誤差變異數符合：

$$
\[
\text{Var}(e_i) = \sigma^2 \cdot \text{INCOME}_i^2
\]
$$

因此使用 **Generalized Least Squares (GLS)** 方法進行估計，並使用 **Robust 標準誤（HC1）** 進行修正，以產生更穩健的推論結果。


<img width="748" alt="76" src="https://github.com/user-attachments/assets/a85721e9-2166-47dd-962a-185c06239e39" />


<img width="769" alt="77" src="https://github.com/user-attachments/assets/d8a2c2f8-44d2-48a9-bcc9-b337ffb60b94" />



KIDS 變數的估計結果

| 模型版本        | 估計值     | 標準誤   | 95% 信賴區間             |
|-----------------|------------|----------|--------------------------|
| OLS (a)         | -81.826    | 27.130   | [-135.329, -28.323]      |
| Robust OLS (d)  | -81.826    | 29.154   | [-138.969, -24.684]      |
| GLS             | -76.806    | 21.848  | [-119.894, -33.718]      |
| Robust GLS      | -76.806    | 22.618  | [-121.139, -32.474]      |



解釋與比較：

kids係數：
- GLS 模型的估計值與 OLS 相比 **略小**（影響較弱），因為GLS使用權重1/INCOME²i，給予低income觀測更大權重，改變了估計。 Robust GLS係數與GLS相同，因為Robust SE不影響點估計。

kids 標準誤:
- GLS模型因考慮heteroskedasticity結構，標準誤相對較小，推論更有效率。

kids的95%信賴區間：
- GLS信賴區間【-119.894,-33.718】比OLS【-135.329,-28.232】窄，估計更精確
- Robust GLS信賴區間【-121.139,-32.474】比GLS略寬，但仍優於OLS與Robust OLS
- Robust GLS 確實提供更窄的信賴區間與更有效的估計，顯示推論更精確。



---



## Q.18

<img width="598" alt="C08Q18" src="https://github.com/user-attachments/assets/78f2796f-895d-456f-9557-e8f20bd905f4" />


## Ans:

<img width="653" alt="2" src="https://github.com/user-attachments/assets/7cb3d475-8451-4115-88ca-e127239452c2" />

---

**(a)**  Goldfeld–Quandt 檢定：檢驗男性與女性的誤差變異是否相同

檢定假設：

- **虛無假設 H₀**：σ²M = σ²F（同質變異）
- **對立假設 H₁**：σ²M ≠ σ²F（異質變異）

計算步驟與結果：

| 項目                | 數值            |
|---------------------|-----------------|
| SSE（男性）         | 1208.99         |
| SSE（女性）         | 925.18          |
| F 統計量            | **1.0538**       |
| 自由度（df₁, df₂） | (5419, 4370)     |
| 臨界值（α = 0.05） | [0.9453, 1.0581] |


結論：

由於 F 統計量 = 1.0538  落在不拒絕區間 \( [0.9453, 1.0581] \)，  

我們**無法拒絕虛無假設**，表示在 5% 顯著水準下，**沒有證據認為男性與女性的誤差變異不同**。


---

**(b)** NR² 檢定：檢驗誤差是否與特定變數有關（異質變異數）

檢定誤差平方是否與 `metro`、`female`、`black` 三個變數有關，作為異質變異數的來源線索。

檢定假設：

- **虛無假設 H₀**：誤差與這些變數無關（同質變異）
- **對立假設 H₁**：誤差與至少一個變數有關（異質變異）

檢定步驟與結果：

| 項目                         | 數值             |
|------------------------------|------------------|
| 樣本數 \( n \)             | 9799             |
| \( NR²  \)（殘差平方迴歸） | 0.0024           |
| \( NR²  \) 統計量         | **23.5568**       |
| <img width="87" alt="1" src="https://github.com/user-attachments/assets/d8b8a84c-9ce2-4d77-bea6-1a936f36f30b" />| **11.3449**       |


結論：

由於 \( NR²  = 23.5568 > 11.3449 \)，我們在 1% 顯著水準下**拒絕虛無假設**，  

表示誤差項與 `metro`、`female`、`black` 變數相關，存在**異質變異數（heteroskedasticity）**。



---

**(c)** White Test 檢定：一般性異質變異數檢定

目的：使用 White test 來檢驗誤差項是否具有異質變異性（heteroskedasticity），

不需指定變異來源，透過變數、平方項與交乘項整體檢驗。

檢定假設：

- **虛無假設 H₀**：誤差項變異數為常數（同質變異）
- **對立假設 H₁**：誤差項變異數非恆定（異質變異）

檢定結果：

| 指標             | 數值       |
|------------------|------------|
| R²               |  0.0198    |
| NR² 統計量        | 194.4447   |
| F 統計量          | 4.4880     |
| F \( p \)-值      | **0.0001076** |


結論：

由於 \( p < 0.01 \)，我們在 1% 顯著水準下**拒絕虛無假設**。 

表示模型存在明顯的 **異質變異數（heteroskedasticity）**，建議採用 robust 標準誤或 FGLS 修正方法。


---

**(d)** OLS vs White Robust 標準誤比較

比較使用 OLS 與 White Robust 標準誤（HC1）後，各變數的推論是否改變，並檢視標準誤變化的幅度。

標準誤對照表：

| 變數              | OLS 標準誤 | Robust 標準誤 | 改變幅度 (%) |
|-------------------|------------|----------------|---------------|
| Intercept         | 0.0321     | 0.0328         | +2.12%        |
| educ              | 0.0018     | 0.0019         | +8.39%        |
| exper             | 0.0013     | 0.0013         | +1.12%        |
| exper²            | 0.0000     | 0.0000         | +4.71%        |
| female            | 0.0095     | 0.0095         | −0.43%        |
| black             | 0.0169     | 0.0161         | −5.01%        |
| metro             | 0.0123     | 0.0116         | −5.89%        |
| south             | 0.0136     | 0.0139         | +2.51%        |
| midwest           | 0.0141     | 0.0137         | −2.69%        |
| west              | 0.0144     | 0.0146         | +1.07%        |


結論：

- 有些變數（如 `educ`, `south`）的 robust 標準誤 **略為變大**，推論更保守。
- 有些變數（如 `black`, `metro`）則標準誤**略微縮小**。
- 整體而言，White 標準誤雖不會大幅改變估計值，但可提升模型推論的穩健性與信賴度。

建議在存在異質變異的情況下採用 White robust 標準誤進行推論。


---

**(e)** FGLS 估計：以 METRO 與 EXPER 為異質變異數來源

為處理異質變異數，本題採用 **FGLS（Feasible GLS）** 方法：

1. 使用 OLS 殘差平方 ê²
2. 對 log(ê²) 進行回歸，設定異質變異來源為 metro 與 expe     
3. 擬合後取得預測值 ĥᵢ , 進行加權最小平方法（WLS）


FGLS 模型估計結果：

| 變數             | 估計值    | 標準誤   | 95% 信賴區間              |
|------------------|-----------|----------|---------------------------|
| Intercept        | 1.1922    | 0.0316   | [1.1303, 1.2541]          |
| educ             | 0.1017    | 0.0018   | [0.0982, 0.1051]          |
| exper            | 0.0301    | 0.0013   | [0.0275, 0.0326]          |
| exper²           | -0.00046  | 0.00003  | [-0.00051, -0.00040]      |
| female           | -0.1662   | 0.0095   | [-0.1848, -0.1476]        |
| black            | -0.1109   | 0.0170   | [-0.1442, -0.0775]        |
| metro            | 0.1178    | 0.0115   | [0.0953, 0.1402]          |
| south            | -0.0448   | 0.0135   | [-0.0713, -0.0183]        |
| midwest          | -0.0632   | 0.0140   | [-0.0906, -0.0358]        |
| west             | -0.0055   | 0.0144   | [-0.0337, 0.0227]         |


結論：

- FGLS 有效修正異質變異數造成的推論偏誤。
- 多數變數仍顯著（信賴區間不含 0），例如 `educ`, `female`, `black`, `metro`。
- 推論更可靠，適用於明顯異質變異數的迴歸模型。


---

**(f)** FGLS + Robust 標準誤比較：兼顧效率與穩健性

目的：在使用 FGLS 處理異質變異數之後，再進一步計算 White robust 標準誤（HC1），

可同時兼顧推論的效率與穩健性，避免過度依賴誤差變異結構的正確性。

FGLS 標準誤 vs Robust FGLS 標準誤：

| 變數             | FGLS 係數 | FGLS SE | Robust SE | SE 變化 (%) |
|------------------|-----------|---------|------------|--------------|
| Intercept        | 1.1922    | 0.0316  | 0.0324     | +2.43%       |
| educ             | 0.1017    | 0.0018  | 0.0019     | +7.26%       |
| exper            | 0.0301    | 0.0013  | 0.0013     | +0.55%       |
| exper²           | -0.0005   | 0.0000  | 0.0000     | +2.31%       |
| female           | -0.1662   | 0.0095  | 0.0094     | −0.45%       |
| black            | -0.1109   | 0.0170  | 0.0159     | −6.61%       |
| metro            | 0.1178    | 0.0115  | 0.0116     | +0.90%       |
| south            | -0.0448   | 0.0135  | 0.0138     | +2.31%       |
| midwest          | -0.0632   | 0.0140  | 0.0137     | −1.94%       |
| west             | -0.0055   | 0.0144  | 0.0145     | +0.92%       |


結論：

- 大多數變數的 **robust 標準誤與 FGLS 相當接近**，表示異質變異數已獲有效控制。
- `black` 的 robust SE 顯著較小 ⇒ 原 FGLS 推論可能偏保守。
- **FGLS + Robust SE 為綜合效率與穩健性的推薦方法**，尤其適用於已知或疑似存在異質變異數的模型中。


---

**(g)** 綜合比較：推薦使用哪一組估計結果？為什麼？

經過以下幾種估計與修正方式後，選擇最適合的模型進行推論：

1. **OLS**（最小平方法）
2. **OLS + White Robust 標準誤**
3. **FGLS**（修正異質變異數）
4. **FGLS + Robust 標準誤**

綜合比較分析：

| 模型版本               | 優點                                                   | 缺點                                                       |
|------------------------|--------------------------------------------------------|------------------------------------------------------------|
| OLS                    | 簡單、易解釋、在誤差為常數變異時效率最高              | 無法處理異質變異數，標準誤可能低估，推論不可信             |
| OLS + Robust SE        | 修正標準誤以應對異質變異，推論較穩健                   | 仍使用未加權的估計值，效率可能不足                         |
| FGLS                   | 處理異質變異數結構，估計更有效率                       | 依賴異質變異模型的正確性，若錯誤會導致偏誤                 |
| FGLS + Robust SE ✅     | 同時處理異質變異與潛在模型誤設，兼顧效率與穩健性       | 稍複雜，需先建模誤差變異結構                               |


結論與推薦：

我推薦使用 **FGLS + Robust 標準誤** 作為最終推論模型，原因如下：

- **(b)(c)** 題已顯示存在明顯異質變異數（NR² 與 White Test 結果顯著）
- **FGLS 有效提升估計效率**，同時修正誤差異質性
- **加上 Robust 標準誤** 可進一步強化模型推論的穩健性
- 標準誤與信賴區間穩定，顯示異質變異已成功控制

這是兼顧效率與穩健性最平衡的選擇，特別適合處理如 wage 模型這類具明顯誤差異質的經濟資料。
