--------------------------------------------------------------------------------------------------------
Q17.
# å®‰è£ä¸¦è¼‰å…¥å¿…è¦çš„å¥—ä»¶
if (!require("remotes")) install.packages("remotes", repos = "https://cloud.r-project.org/")
if (!require("ggplot2")) install.packages("ggplot2", repos = "https://cloud.r-project.org/")

# å®‰è£ä¸¦è¼‰å…¥ POE5Rdata è³‡æ–™é›†ï¼ˆä¾†è‡ª GitHubï¼‰
if (!require("POE5Rdata")) {
  remotes::install_github("ccolonescu/POE5Rdata")
}
library(POE5Rdata)

# è¼‰å…¥ collegetown è³‡æ–™é›†
data("collegetown")

# ç¢ºèªè³‡æ–™æ ¼å¼
class(collegetown)
str(collegetown)

# ç¢ºä¿è®Šæ•¸åç¨±æ­£ç¢º
names(collegetown)

# æª¢æŸ¥ sqft å’Œ price æ˜¯å¦ç‚ºæ•¸å€¼å‹æ…‹ï¼Œé¿å… ggplot å‡ºéŒ¯
collegetown$sqft <- as.numeric(collegetown$sqft)
collegetown$price <- as.numeric(collegetown$price)

# å»é™¤ NA å€¼ï¼Œé¿å…å›æ­¸æ¨¡å‹éŒ¯èª¤
collegetown <- na.omit(collegetown)

# ç¹ªè£½æ•£é»åœ–
library(ggplot2)
ggplot(collegetown, aes(x = sqft, y = price)) +  
  geom_point(color = "blue", alpha = 0.6) +
  labs(title = "æˆ¿å±‹åƒ¹æ ¼èˆ‡æˆ¿å±‹é¢ç©çš„é—œä¿‚",
       x = "æˆ¿å±‹é¢ç©ï¼ˆç™¾å¹³æ–¹è‹±å°ºï¼‰",
       y = "æˆ¿åƒ¹ï¼ˆåƒç¾å…ƒï¼‰") +
  theme_minimal()

# åŸ·è¡Œç·šæ€§å›æ­¸
model <- lm(price ~ sqft, data = collegetown)

# é¡¯ç¤ºå›æ­¸çµæœ
summary(model)

# ç¹ªè£½æ•£é»åœ–èˆ‡å›æ­¸ç·š
ggplot(collegetown, aes(x = sqft, y = price)) +
  geom_point(color = "blue", alpha = 0.6) +  # æ•£é»åœ–
  geom_smooth(method = "lm", color = "red", se = FALSE, linewidth = 1.2) +  # å›æ­¸ç·š
  labs(title = "æˆ¿å±‹åƒ¹æ ¼èˆ‡æˆ¿å±‹é¢ç©çš„å›æ­¸åˆ†æ",
       x = "æˆ¿å±‹é¢ç©ï¼ˆç™¾å¹³æ–¹è‹±å°ºï¼‰",
       y = "æˆ¿åƒ¹ï¼ˆåƒç¾å…ƒï¼‰") +
  theme_minimal()
![image](https://github.com/user-attachments/assets/cf4985d7-0596-488e-991d-92606279691e)

--------------------------------------------------------------------------------------------------------
Q25.
# 1ï¸âƒ£ å®‰è£ä¸¦è¼‰å…¥å¿…è¦å¥—ä»¶
if (!require("remotes")) install.packages("remotes", repos = "https://cloud.r-project.org/")
if (!require("ggplot2")) install.packages("ggplot2", repos = "https://cloud.r-project.org/")
if (!require("dplyr")) install.packages("dplyr", repos = "https://cloud.r-project.org/")
if (!require("POE5Rdata")) remotes::install_github("ccolonescu/POE5Rdata")

library(ggplot2)
library(dplyr)
library(POE5Rdata)

# 2ï¸âƒ£ è¼‰å…¥æ•¸æ“š
data("cex5_small")
data <- cex5_small

# 3ï¸âƒ£ æª¢æŸ¥æ•¸æ“šçµæ§‹
str(data)
summary(data)

# 4ï¸âƒ£ ç¹ªè£½ foodaway ç›´æ–¹åœ–
ggplot(data, aes(x = foodaway)) +
  geom_histogram(binwidth = 50, fill = "lightblue", color = "black") +
  labs(title = "FOODAWAY çš„ç›´æ–¹åœ–", x = "æ¯äººæ¯æœˆå¤–é£Ÿæ”¯å‡º (ç¾å…ƒ)", y = "é »æ•¸") +
  theme_minimal()

# 5ï¸âƒ£ è¨ˆç®—çµ±è¨ˆæŒ‡æ¨™
summary_stats <- data %>%
  summarise(
    Mean_FOODAWAY = mean(foodaway, na.rm = TRUE),
    Median_FOODAWAY = median(foodaway, na.rm = TRUE),
    Q25 = quantile(foodaway, 0.25, na.rm = TRUE),
    Q75 = quantile(foodaway, 0.75, na.rm = TRUE)
  )
print(summary_stats)

# 6ï¸âƒ£ å»ºç«‹ education è®Šæ•¸
data <- data %>%
  mutate(education = case_when(
    advanced == 1 ~ "Advanced Degree",
    college == 1 ~ "College Degree",
    TRUE ~ "No Degree"
  ))

# 7ï¸âƒ£ è¨ˆç®—ä¸åŒæ•™è‚²ç¨‹åº¦çš„ FOODAWAY çµ±è¨ˆæ•¸æ“š
summary_edu <- data %>%
  group_by(education) %>%
  summarise(
    Mean_FOODAWAY = mean(foodaway, na.rm = TRUE),
    Median_FOODAWAY = median(foodaway, na.rm = TRUE),
    Sample_Size = n()
  )
print(summary_edu)

# 8ï¸âƒ£ æª¢æŸ¥ foodaway æ˜¯å¦æœ‰ 0 æˆ–è² å€¼
num_zero_or_negative <- sum(data$foodaway <= 0, na.rm = TRUE)
print(paste("FOODAWAY å°æ–¼ç­‰æ–¼ 0 çš„ç­†æ•¸ï¼š", num_zero_or_negative))

# 9ï¸âƒ£ å–è‡ªç„¶å°æ•¸ï¼Œä¸¦éæ¿¾ FOODAWAY > 0
data <- data %>%
  filter(foodaway > 0) %>%
  mutate(ln_foodaway = log(foodaway))

# ğŸ”Ÿ æª¢æŸ¥ ln_foodaway è®Šæ•¸
summary(data$ln_foodaway)

# 1ï¸âƒ£1ï¸âƒ£ ç¹ªè£½ ln(foodaway) ç›´æ–¹åœ–
ggplot(data, aes(x = ln_foodaway)) +
  geom_histogram(binwidth = 0.2, fill = "lightblue", color = "black") +
  labs(title = "ln(FOODAWAY) çš„ç›´æ–¹åœ–", x = "ln(FOODAWAY)", y = "é »æ•¸") +
  theme_minimal()

# 1ï¸âƒ£2ï¸âƒ£ è¨ˆç®— ln(foodaway) çš„çµ±è¨ˆæŒ‡æ¨™
summary_ln_foodaway <- data %>%
  summarise(
    Mean_LN_FOODAWAY = mean(ln_foodaway, na.rm = TRUE),
    Median_LN_FOODAWAY = median(ln_foodaway, na.rm = TRUE),
    Q25_LN = quantile(ln_foodaway, 0.25, na.rm = TRUE),
    Q75_LN = quantile(ln_foodaway, 0.75, na.rm = TRUE)
  )
print(summary_ln_foodaway)

# 1ï¸âƒ£3ï¸âƒ£ è¨ˆç®—ç¼ºå¤±å€¼æ•¸é‡
missing_values <- data %>%
  summarise(
    Missing_FOODAWAY = sum(is.na(foodaway)),
    Missing_LN_FOODAWAY = sum(is.na(ln_foodaway))
  )
print(missing_values)

# 1ï¸âƒ£4ï¸âƒ£ å»ºç«‹å›æ­¸æ¨¡å‹ ln(foodaway) ~ income
model <- lm(ln_foodaway ~ income, data = data)

# 1ï¸âƒ£5ï¸âƒ£ é¡¯ç¤ºå›æ­¸çµæœ
summary(model)

# 1ï¸âƒ£6ï¸âƒ£ ç¹ªè£½ ln(foodaway) èˆ‡ income çš„å›æ­¸åœ–
ggplot(data, aes(x = income, y = ln_foodaway)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "ln(FOODAWAY) èˆ‡ INCOME çš„å›æ­¸åˆ†æ",
       x = "å®¶åº­æœˆæ”¶å…¥ï¼ˆ$100 ç¾å…ƒï¼‰",
       y = "ln(FOODAWAY)") +
  theme_minimal()

# 1ï¸âƒ£7ï¸âƒ£ è¨ˆç®—æ®˜å·®
data <- data %>%
  mutate(residuals = residuals(model))

# 1ï¸âƒ£8ï¸âƒ£ ç¹ªè£½æ®˜å·®åœ–
ggplot(data, aes(x = income, y = residuals)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "æ®˜å·®èˆ‡ INCOME çš„é—œä¿‚",
       x = "å®¶åº­æœˆæ”¶å…¥ï¼ˆ$100 ç¾å…ƒï¼‰",
       y = "æ®˜å·® (ln(FOODAWAY))") +
  theme_minimal()
![image](https://github.com/user-attachments/assets/49dca60d-a159-4687-88d4-dfaf51658f45)

--------------------------------------------------------------------------------------------------------
Q28.
# 1ï¸âƒ£ å®‰è£ä¸¦è¼‰å…¥å¿…è¦å¥—ä»¶
if (!require("remotes")) install.packages("remotes", repos = "https://cloud.r-project.org/")
if (!require("ggplot2")) install.packages("ggplot2", repos = "https://cloud.r-project.org/")
if (!require("dplyr")) install.packages("dplyr", repos = "https://cloud.r-project.org/")
if (!require("broom")) install.packages("broom", repos = "https://cloud.r-project.org/")
if (!require("POE5Rdata")) remotes::install_github("ccolonescu/POE5Rdata")

library(ggplot2)
library(dplyr)
library(broom)
library(POE5Rdata)

# 2ï¸âƒ£ è¼‰å…¥æ•¸æ“š
data("cps5_small")
data <- cps5_small

# 3ï¸âƒ£ æª¢æŸ¥æ•¸æ“šçµæ§‹
str(data)
summary(data)

# 4ï¸âƒ£ è¨ˆç®—çµ±è¨ˆæ•¸æ“š
summary_stats <- data %>%
  summarise(
    Mean_Wage = mean(wage, na.rm = TRUE),
    SD_Wage = sd(wage, na.rm = TRUE),
    Median_Wage = median(wage, na.rm = TRUE),
    Q25_Wage = quantile(wage, 0.25, na.rm = TRUE),
    Q75_Wage = quantile(wage, 0.75, na.rm = TRUE),
    Mean_Educ = mean(educ, na.rm = TRUE),
    SD_Educ = sd(educ, na.rm = TRUE),
    Median_Educ = median(educ, na.rm = TRUE),
    Q25_Educ = quantile(educ, 0.25, na.rm = TRUE),
    Q75_Educ = quantile(educ, 0.75, na.rm = TRUE)
  )
print(summary_stats)

# 5ï¸âƒ£ ç¹ªè£½ WAGE å’Œ EDUC ç›´æ–¹åœ–
ggplot(data, aes(x = wage)) +
  geom_histogram(binwidth = 2, fill = "lightblue", color = "black") +
  labs(title = "WAGE ç›´æ–¹åœ–", x = "æ™‚è–ªï¼ˆç¾å…ƒï¼‰", y = "é »æ•¸") +
  theme_minimal()

ggplot(data, aes(x = educ)) +
  geom_histogram(binwidth = 1, fill = "lightblue", color = "black") +
  labs(title = "EDUC ç›´æ–¹åœ–", x = "å—æ•™è‚²å¹´æ•¸", y = "é »æ•¸") +
  theme_minimal()

# 6ï¸âƒ£ å»ºç«‹ç·šæ€§å›æ­¸æ¨¡å‹
linear_model <- lm(wage ~ educ, data = data)
summary(linear_model)

# 7ï¸âƒ£ è¨ˆç®—ä¸¦å„²å­˜æ®˜å·®
data <- data %>%
  mutate(residuals = residuals(linear_model))

# 8ï¸âƒ£ ç¹ªè£½æ®˜å·®åœ–
ggplot(data, aes(x = educ, y = residuals)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(title = "Residuals vs. EDUC",
       x = "Years of Education (EDUC)",
       y = "Residuals") +
  theme_minimal()

# 9ï¸âƒ£ åˆ†ç¾¤å›æ­¸åˆ†æ
model_all <- lm(wage ~ educ, data = data)
model_male <- lm(wage ~ educ, data = filter(data, female == 0))
model_female <- lm(wage ~ educ, data = filter(data, female == 1))
model_black <- lm(wage ~ educ, data = filter(data, black == 1))
model_non_black <- lm(wage ~ educ, data = filter(data, black == 0))

# 1ï¸âƒ£0ï¸âƒ£ å–å¾— tidy æ ¼å¼çµæœä¸¦åˆä½µ
final_table <- bind_rows(
  tidy(model_all) %>% mutate(Group = "All"),
  tidy(model_male) %>% mutate(Group = "Male"),
  tidy(model_female) %>% mutate(Group = "Female"),
  tidy(model_black) %>% mutate(Group = "Black"),
  tidy(model_non_black) %>% mutate(Group = "Non-Black")
) %>%
  select(Group, term, estimate, std.error, statistic, p.value) %>%
  arrange(term, Group)

print(final_table)

# 1ï¸âƒ£1ï¸âƒ£ å»ºç«‹ EDUC å¹³æ–¹è®Šæ•¸ä¸¦ä¼°è¨ˆäºŒæ¬¡å›æ­¸
data <- data %>%
  mutate(educ2 = educ^2)

quad_model <- lm(wage ~ educ + educ2, data = data)
summary(quad_model)

# 1ï¸âƒ£2ï¸âƒ£ æå– Î±â‚‚ ä¸¦è¨ˆç®—é‚Šéš›æ•ˆæœ
alpha2 <- coef(quad_model)["educ2"]

marginal_effect_12 <- 2 * alpha2 * 12
marginal_effect_16 <- 2 * alpha2 * 16

print(paste("Marginal Effect at EDUC = 12:", marginal_effect_12))
print(paste("Marginal Effect at EDUC = 16:", marginal_effect_16))

# 1ï¸âƒ£3ï¸âƒ£ ç¹ªè£½ç·šæ€§èˆ‡äºŒæ¬¡å›æ­¸çš„æ¯”è¼ƒåœ–
data <- data %>%
  mutate(
    linear_fit = predict(linear_model),
    quad_fit = predict(quad_model)
  )

ggplot(data, aes(x = educ, y = wage)) +
  geom_point(alpha = 0.4, color = "gray") +  # åŸå§‹è³‡æ–™é»
  geom_line(aes(y = linear_fit), color = "blue", size = 1.2, linetype = "dashed") +  # ç·šæ€§æ“¬åˆç·š
  geom_line(aes(y = quad_fit), color = "red", size = 1.2) +  # äºŒæ¬¡æ“¬åˆç·š
  labs(title = "Linear vs Quadratic Fit of Wage on Education",
       x = "Years of Education",
       y = "Hourly Wage") +
  theme_minimal() +
  theme(legend.position = "bottom")
![image](https://github.com/user-attachments/assets/8962e42a-0608-4a49-ac94-3749275b7362)

