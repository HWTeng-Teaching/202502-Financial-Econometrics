
### 10.20 The CAPM [see Exercises 10.14 and 2.16] says that the risk premium on security j is related to the risk premium on the market portfolio. That is rj − r𝑓 = αj + βj(rm − r𝑓) where rj and rf are the returns to security j and the risk-free rate, respectively, rm is the return on the market portfolio, and βj is the jth security’s “beta” value. We measure the market portfolio using the Standard & Poor’s value weighted index, and the risk-free rate by the 30-day LIBOR monthly rate of return. As noted in Exercise 10.14, if the market return is measured with error, then we face an errors-in-variables, or measurement error, problem.

### (a) Use the observations on Microsoft in the data file capm5 to estimate the CAPM model using OLS. How would you classify the Microsoft stock over this period? Risky or relatively safe, relative to the market portfolio?
```r
# R code
capm5$msft_excess <- capm5$msft - capm5$riskfree
capm5$mkt_excess <- capm5$mkt - capm5$riskfree
capm_model <- lm(msft_excess ~ mkt_excess, data = capm5)
summary(capm_model)
```
![1](https://github.com/user-attachments/assets/fd675bd4-4bec-46be-842e-592470282ee6)

Microsoft beta is 1.2018.
Microsoft stock is relatively risky compared to the market portfolio. 


### (b) It has been suggested that it is possible to construct an IV by ranking the values of the explanatory variable and using the rank as the IV, that is, we sort (rm − r𝑓) from smallest to largest, and assign the values RANK = 1, 2, . . . . , 180. Does this variable potentially satisfy the conditions IV1–IV3? Create RANK and obtain the first-stage regression results. Is the coefficient of RANK very significant? What is the R2 of the first-stage regression? Can RANK be regarded as a strong IV?
```r
# R code
capm5$RANK <- rank(capm5$mkt_excess)
first_stage <- lm(mkt_excess ~ RANK, data = capm5)
summary(first_stage)
linearHypothesis(first_stage, c("RANK=0"))
```
![2](https://github.com/user-attachments/assets/20692682-e56d-4d61-bdec-d345b9a124c1)
![5](https://github.com/user-attachments/assets/4468f340-760a-4ad4-9183-6134c13df191)


The variable RANK does not directly cause Microsoft’s return, so it meets condition.
R^2 = 0.9126.
The t-value is 43.10, and the F-statistic is 1857.61.
This means that RANK is a very strong instrument.

### (c) Compute the first-stage residuals, ̂v, and add them to the CAPM model. Estimate the resulting augmented equation by OLS and test the significance of ̂v at the 1% level of significance. Can we conclude that the market return is exogenous?
```r
# R code
capm5$v_hat <- resid(first_stage)
second_stage <- lm(msft_excess ~ mkt_excess + v_hat, data = capm5)
summary(second_stage)
```
![3](https://github.com/user-attachments/assets/2b5e2d02-a7fc-4bec-bf4a-803fc2a35bd5)

The t-statistic on v ̂ is −2.04 with a p = 0.043.
It is not significant at the 1% level, but at the 5% level. 
At the 1% level, we cannot reject the null hypothesis that the market return is exogenous.

![image](https://github.com/user-attachments/assets/99e7da4f-bc91-4c8f-a099-91f90528267f)
## 
![image](https://github.com/user-attachments/assets/9b577874-fdb7-4109-bd24-5850be2b4e8a)

## (d) IV/2SLS Estimation Using `RANK` as an Instrument

In this section, we estimate the CAPM model using two-stage least squares (2SLS), treating the market excess return as a potentially endogenous regressor. The instrument used is `RANK`, which is constructed by ranking the values of the market excess return from smallest to largest.

---

### Step 1: Construct the Instrument `RANK`

```r
# Create the instrumental variable RANK by ranking the market excess returns
# from smallest to largest.
capm$RANK <- rank(capm$excess_mkt, ties.method = "first")
```

---

### Step 2: First‐Stage Regression

We regress `excess_mkt` on `RANK` to obtain fitted values.

excess_mkt<sub>t</sub> = π<sub>0</sub> + π<sub>1</sub> · RANK<sub>t</sub> + v<sub>t</sub>

```r
first_stage <- lm(excess_mkt ~ RANK, data = capm)
summary(first_stage)
```

**Results:**
- R<sup>2</sup> = 0.913  
- F-statistic = 1858  
- `RANK` is **highly significant** (p < 0.001)  

> This confirms that `RANK` is a **strong instrument**.

---

### Step 3: 2SLS Estimation using `ivreg()`

We estimate the CAPM equation using `RANK` as the instrument for `excess_mkt`.

excess_msft<sub>t</sub> = α + β · excess_mkt<sub>t</sub> + ε<sub>t</sub>


```r
library(AER)

iv_model <- ivreg(excess_msft ~ excess_mkt | RANK, data = capm)
summary(iv_model)
```

---

### Estimation Results

| Method   | Beta (Market Coefficient) | Std. Error | t Value | Significance |
|----------|---------------------------:|-----------:|--------:|--------------|
| **OLS**  | 1.2018                     | 0.1222     | 9.839   | ***          |
| **2SLS** | 1.2783                     | 0.1280     | 9.986   | ***          |

---

### Conclusion

The 2SLS estimate of β is **greater** than the OLS estimate, consistent with theoretical expectations under **measurement error**:

- OLS estimates are biased **toward zero** when regressors are measured with error.  
- The strong performance of the instrument `RANK` ensures reliable identification.



![image](https://github.com/user-attachments/assets/44fb74dd-8c48-4fbb-bac7-6db36a39facd)


## (e) First‐Stage Regression with `RANK` and `POS` as Instruments

In this section, we extend the first‐stage regression to include both `RANK` and `POS` as instruments for the potentially endogenous regressor `excess_mkt`.

---

### Step 1: Construct the Instrument `POS`

```r
# Create the binary instrument POS: 1 if market excess return is positive, 0 otherwise
capm$POS <- ifelse(capm$excess_mkt > 0, 1, 0)
```

---

### Step 2: First‐Stage Regression

We regress `excess_mkt` on `RANK` and `POS`:


excess_mkt<sub>t</sub> = π<sub>0</sub> + π<sub>1</sub> · RANK<sub>t</sub> + π<sub>2</sub> · POS<sub>t</sub> + v<sub>t</sub>


```r
first_stage2 <- lm(excess_mkt ~ RANK + POS, data = capm)
summary(first_stage2)
```

**Results:**
- R<sup>2</sup> = 0.9149  
- F-statistic: 951.3 on 2 and 177 DF (p < 0.001)  
- `RANK` is highly significant (p < 0.001)  
- `POS` is significant at 5% level (p = 0.0291)  

> This confirms that `RANK` and `POS` are **jointly strong instruments**.

---

### Conclusion

The first‐stage regression shows that the two instruments explain over 91% of the variation in `excess_mkt` and pass the joint‐significance test (F ≫ 10). Therefore, `RANK` and `POS` form an adequately strong IV set for the subsequent 2SLS estimation.  


![image](https://github.com/user-attachments/assets/e03717d9-86b5-45c9-83d0-b17783b2eab4)


## (f) Hausman Test for Endogeneity

In this section, we carry out the Hausman test to determine whether the market excess return (`excess_mkt`) is endogenous, using the residuals from the first‐stage regression in part (e).

---

### Step 1: Extract First‐Stage Residuals

excess_mkt<sub>t</sub> = π<sub>0</sub> + π<sub>1</sub> · RANK<sub>t</sub> + π<sub>2</sub> · POS<sub>t</sub> + vhat2<sub>t</sub>

```r
# Obtain residuals from the first-stage regression (instruments: RANK + POS)
capm$vhat2 <- resid(first_stage2)
```

---

### Step 2: Augmented Regression

We augment the original CAPM model with the first‐stage residuals:


excess_msft<sub>t</sub> = α + β · excess_mkt<sub>t</sub> + δ · vhat2<sub>t</sub> + ε<sub>t</sub>

**Hypotheses:**

- H<sub>0</sub>: δ = 0  (market return is exogenous)
- H<sub>a</sub>: δ ≠ 0  (market return is endogenous)


```r
hausman_model <- lm(excess_msft ~ excess_mkt + vhat2, data = capm)
summary(hausman_model)
```

**Results:**
- Coefficient of `vhat2`: **−0.9549**  
- Std. Error: 0.4331  
- t value: −2.205  
- p value: **0.0287**

---

### Conclusion

The null hypothesis H<sub>0</sub>: &delta; = 0 (market return is exogenous) is tested at the 1% significance level.

- **p value = 0.0287 ≥ 0.01**  
- We **do not reject** H<sub>0</sub> at the 1% level.

> **Therefore, we conclude that the market excess return can be treated as exogenous at the 1% significance level.**
